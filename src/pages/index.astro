---
import { getCollection } from 'astro:content'
import Layout from '../layouts/Layout.astro'
import type { Props as HeadProps } from '@components/Head.astro'

import ADSPhoneBanner from '@components/ADSPhoneBanner.astro'
import AboutMe from '@components/AboutMe.astro'

type Props = HeadProps

const allPosts = (await getCollection('blog')).sort(
  (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
)
const latestPosts = allPosts.slice(0, 2)

/**
 * Truncates the description to 24 words
 * @param description - The description to truncate
 * @returns The truncated description
 */

function truncateDescription(description: string) {
  const words = description.split(' ')
  if (words.length <= 24) {
    return description
  } else {
    const truncatedWords = words.slice(0, 24)
    return truncatedWords.join(' ') + '...'
  }
}
---

<Layout
  meta={{
    title: 'Frank Stallone | Sharing 25 years of working on the web',
    description:
      'For the last two decades, I have helped businesses of all sizes craft compelling user experiences that drove 100M+ in revenue.',
  }}
>
  <section class="region flow md:pt-zero md:-mt-s" id="main">
    <div class="flow wrapper">
      <div class="grid" data-layout="label" style="--gutter: var(--space-l);">
        <div class="flow" style="--flow-space: var(--space-xs);">
          <h2 class="text-step-1 text-gray-1400">Recent posts</h2>
          <p class="text-step-00 text-gray-1100">
            Writing on design, systems, and craft.
          </p>
          <a class="text-step-00 text-gray-1100" href="/blog/">All posts</a>
        </div>
        <ol role="list" class="flow" style="--flow-space: var(--space-s);">
          {
            latestPosts.map((post) => (
              <li class="flow prose border-t border-gray-600 pt-s last:pb-0">
                <h3 class="mt-zero">
                  <a
                    href={`/${post.collection}/${post.id}/`}
                    transition:name={'blog' + post.data.title}
                  >
                    {post.data.title}
                  </a>
                </h3>
                <p class="mt-2xs">
                  <small class="text-step-00 text-gray-1100 tabular-nums">
                    {new Date(post.data.publishDate).toLocaleDateString(
                      undefined,
                      {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                      }
                    )}
                  </small>
                </p>
                <p>{truncateDescription(post.data.description)}</p>
                <p class="pb-s">
                  <a href={`/${post.collection}/${post.id}/`}>
                    Read more &hellip;
                  </a>
                </p>
              </li>
            ))
          }
        </ol>
      </div>
    </div>
  </section>
  <AboutMe />
  <div class="region bg-gray-100">
    <div class="wrapper">
      <div class="grid" data-layout="label" style="--gutter: var(--space-l);">
        <div class="flow" style="--flow-space: var(--space-xs);">
          <h2 class="text-step-1 text-gray-1400">Portfolio</h2>
          <p class="text-step-00 text-gray-1100">
            Selected work from product and systems design.
          </p>
        </div>
        <div class="flow" style="--flow-space: var(--space-l);">
          <ADSPhoneBanner />
          <div class="flow" style="--flow-space: var(--space-s);">
            <video
              autoplay
              loop
              muted
              playsinline
              class="min-w-zero max-w-full"
              poster="/media/klaviyo/klaviyo-phone-input-cover-web.png"
            >
              <source
                src="/media/klaviyo/klaviyo-phone-input-cover-web.webm"
                type="video/webm"
              />
              <source
                src="/media/klaviyo/klaviyo-phone-input-cover-web.mp4"
                type="video/mp4"
              />
            </video>
            <p class="text-step-00 text-gray-1100">
              1 of 5 <a href="/portfolio/">See full portfolio</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>
