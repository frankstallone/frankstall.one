---
import { getCollection, type CollectionEntry } from 'astro:content'
import type { Page } from 'astro'
import InnerLayout from '../../layouts/InnerLayout.astro'

export const getStaticPaths = async ({ paginate }: { paginate: Function }) => {
  const allPosts = (await getCollection('blog')).sort(
    (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
  )
  return paginate(allPosts, { pageSize: 10 })
}

interface Props {
  page: Page<CollectionEntry<'blog'>>
}

const { page } = Astro.props
const canonicalURL = new URL(Astro.url.pathname, Astro.site)
---

<InnerLayout
  meta={{
    title: 'Blog posts by Frank Stallone',
    description:
      'The writing of Frank Stallone, a UX Enginineer living in the Northeast',
    canonicalURL: canonicalURL.href,
  }}
>
  <section class="region" id="main">
    <div class="wrapper flow" style="--flow-space: var(--space-l);">
      <div class="grid gap-l md:grid-cols-2">
        {
          page.data.map((post) => (
            <div class="flow prose post-card">
              <h3 class="mt-zero">
                <a href={`/${post.collection}/${post.id}/`}>
                  {post.data.title}
                </a>
              </h3>
              <p class="mt-2xs ">
                <small class="text-step-00 text-gray-1100 tabular-nums">
                  {new Date(post.data.publishDate).toLocaleDateString(
                    undefined,
                    {
                      weekday: 'long',
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    },
                  )}
                </small>
              </p>
              <p>{post.data.description}</p>
              <p class="pb-l">
                <a href={`/${post.collection}/${post.id}/`}>
                  Read more &hellip;
                </a>
              </p>
            </div>
          ))
        }
      </div>
      <nav
        class="flex justify-between items-center text-step-00 text-gray-1100 tabular-nums"
      >
        {
          page.url.prev ? (
            <a href={page.url.prev}>← Previous</a>
          ) : (
            <span class="text-gray-700">← Previous</span>
          )
        }
        <span>
          Page {page.currentPage} of {page.lastPage}
        </span>
        {
          page.url.next ? (
            <a href={page.url.next}>Next →</a>
          ) : (
            <span class="text-gray-700">Next →</span>
          )
        }
      </nav>
    </div>
  </section>
</InnerLayout>
